<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript">
            var URL = "http://localhost:8080/ecommerce-web/listarprodutos";
            function init() {
                fazerRequisicao(listarProdutos);
                //fazerRequisicao(listarCategorias);
                //fazerRequisicao(listarMarcas);
            }

            function fazerRequisicao(callback) {
                var http = new XMLHttpRequest();
                http.onreadystatechange = function ()
                {
                    if (this.readyState === 4 && this.status === 200) {
                        document.getElementById("result").innerHTML = "Ok.";
                        console.log(this.responseText);
                        callback(this.responseText);
                    }
                    if (this.readyState === 4 && this.status !== 200) {
                        document.getElementById("result").innerHTML = "Erro: " + this.statusText;
                    }
                    if (this.readyState === 3) {
                        document.getElementById("result").innerHTML = "Aguarde...";
                    }
                };
                http.open("GET", URL);
                http.setRequestHeader("Authorization", "ehaiuahdfu32ioqpeyrq");
                http.send();
            }            
            function listarProdutos(jsonData) {
                var jsons = jsonData.split("#GL#");                               
                var objProd = JSON.parse(jsons[0]);
                var objCat = JSON.parse(jsons[1]);
                var objMarc = JSON.parse(jsons[2]);
                
                var dv, img, hCinco, p;
                for (var i = 0; i < objProd.length; i++)
                {
                    dv = document.createElement('div');
                    document.body.appendChild(dv);
                    dv.setAttribute('class', 'produto-mini');
                    img = document.createElement('img');
                    img.src = objProd[i]['fotoProduto'];
                    img.setAttribute('class', 'foto-mini');
                    dv.appendChild(img);
                    hCinco = document.createElement('h5');
                    hCinco.innerText = objProd[i]['produto'];
                    hCinco.setAttribute('class', 'hCinco-mini');
                    p = document.createElement('p');
                    p.innerText = objProd[i]['precoProduto'];
                    p.setAttribute('class', 'preco-mini');
                    dv.appendChild(p);
                    hCinco = document.createElement('h5');
                    hCinco.innerText = objProd[i]['produto'];
                    dv.appendChild(hCinco);                   
                }
            }

        </script> 
    </head>
    <body onload="init()">
        <div>TODO write content</div>
        <div id="result"></div>
    </body>
</html>
